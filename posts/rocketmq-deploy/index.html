<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Docker 环境部署 RocketMQ - Yusank`s Site</title><meta name=Description content="这是我的个人博客，我会在这里分享学习和成长过程中的积累和经验."><meta property="og:title" content="Docker 环境部署 RocketMQ"><meta property="og:description" content="
最近在某个项目中需要引入RocketMQ来处理一些业务逻辑，然后由于还没上线，需要本地搭建开发环境，由于第一次接触 RocketMQ 所以在部署的过程有些曲折，通过这篇文章记录部署过程和遇到的一些问题，希望对看到的读者有所帮助。
"><meta property="og:type" content="article"><meta property="og:url" content="https://yusank.github.io/posts/rocketmq-deploy/"><meta property="og:image" content="https://yusank.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-14T10:10:00+08:00"><meta property="article:modified_time" content="2022-05-04T15:29:57+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yusank.github.io/logo.png"><meta name=twitter:title content="Docker 环境部署 RocketMQ"><meta name=twitter:description content="
最近在某个项目中需要引入RocketMQ来处理一些业务逻辑，然后由于还没上线，需要本地搭建开发环境，由于第一次接触 RocketMQ 所以在部署的过程有些曲折，通过这篇文章记录部署过程和遇到的一些问题，希望对看到的读者有所帮助。
"><meta name=application-name content="Yusank's Site"><meta name=apple-mobile-web-app-title content="Yusank's Site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://yusank.github.io/images/logo.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yusank.github.io/posts/rocketmq-deploy/><link rel=prev href=https://yusank.github.io/posts/pdf-reader/><link rel=next href=https://yusank.github.io/posts/macapp-by-go/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Docker 环境部署 RocketMQ","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yusank.github.io\/posts\/rocketmq-deploy\/"},"genre":"posts","keywords":"docker, rocketmq","wordcount":1943,"url":"https:\/\/yusank.github.io\/posts\/rocketmq-deploy\/","datePublished":"2022-03-14T10:10:00+08:00","dateModified":"2022-05-04T15:29:57+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Yusank"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Yusank`s Site"><img class="lazyload logo" src=/svg/loading.min.svg data-src=https://yusank.github.io/images/logo.svg data-srcset="https://yusank.github.io/images/logo.svg, https://yusank.github.io/images/logo.svg 1.5x, https://yusank.github.io/images/logo.svg 2x" data-sizes=auto alt=https://yusank.github.io/images/logo.svg title=https://yusank.github.io/images/logo.svg><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=/links/>友链 </a><a class=menu-item href=https://github.com/yusank title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><a class=menu-item href=https://go-goim.github.io title=GoIM rel="noopener noreffer" target=_blank><i class='far fa-share-square'></i> GoIM </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yusank`s Site"><img class="lazyload logo" src=/svg/loading.min.svg data-src=https://yusank.github.io/images/logo.svg data-srcset="https://yusank.github.io/images/logo.svg, https://yusank.github.io/images/logo.svg 1.5x, https://yusank.github.io/images/logo.svg 2x" data-sizes=auto alt=https://yusank.github.io/images/logo.svg title=https://yusank.github.io/images/logo.svg><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=/links/ title>友链</a><a class=menu-item href=https://github.com/yusank title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a class=menu-item href=https://go-goim.github.io title=GoIM rel="noopener noreffer" target=_blank><i class='far fa-share-square'></i>GoIM</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Docker 环境部署 RocketMQ</h1><h2 class=single-subtitle>记录在 Docker 环境下部署 RocketMQ 的过程</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/yusank title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Yusank</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/docker/><i class="far fa-folder fa-fw" aria-hidden=true></i>Docker</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-03-14>2022-03-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1943 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-背景>1. 背景</a></li><li><a href=#2-部署>2. 部署</a></li><li><a href=#3-遇到的问题>3. 遇到的问题</a><ul><li><a href=#31-没有最新的镜像>3.1. 没有最新的镜像</a></li><li><a href=#32-docker-环境宿主机上程序无法正常连接>3.2. docker 环境宿主机上程序无法正常连接</a></li></ul></li><li><a href=#4-总结>4. 总结</a></li><li><a href=#5-链接>5. 链接🔗</a></li></ul></nav></div></div><div class=content id=content><blockquote><p>最近在某个项目中需要引入<code>RocketMQ</code>来处理一些业务逻辑，然后由于还没上线，需要本地搭建开发环境，由于第一次接触 <code>RocketMQ</code> 所以在部署的过程有些曲折，通过这篇文章记录部署过程和遇到的一些问题，希望对看到的读者有所帮助。</p></blockquote><h2 id=1-背景>1. 背景</h2><p>由于业务需求需要搭建一个本地开发环境，而我几乎所有的依赖（各种数据库，工具之类的）都基于 docker 运行，方便随时启停和更新，同时保证宿主机上不会安装各类不常用的环境。</p><p>在需要一个 <code>RocketMQ</code> 的时候 我也是习惯性的直接搜其镜像，但是让我比较意外的是，作为一个 <code>Apache</code> 项目，其镜像最后更新时间居然在2年前。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./dockerhub.png data-srcset="./dockerhub.png, ./dockerhub.png 1.5x, ./dockerhub.png 2x" data-sizes=auto alt=./dockerhub.png title="docker hub"></p><p>而我不知道要不要用这个镜像以及怎么用的时候又发现了官方的一个 repo：<a href=https://github.com/apache/rocketmq-docker target=_blank rel="noopener noreffer">apache/rocketmq-docker</a>。</p><p>这个 repo 提供了如何自己打包一个镜像或者用官方的镜像在不同环境下部署 RocketMQ，包括单节点，docker-compose 以及 k8s 环境。</p><p>因为官方的镜像确实比较老旧，最新才 4.6.0，而最新版本以及到 4.9.x 了，我本来想自己打包一个最新的镜像来着。但是看到需要配置一堆 JAVA 环境，我就放弃了，一是不熟悉 JAVA 的配置，另外一方面我不想为了这个浪费我太多时间，所以选择以 4.6.0 版本下部署一个本地环境。</p><h2 id=2-部署>2. 部署</h2><p>关于本地部署的步骤，我们需要先将 <a href=https://github.com/apache/rocketmq-docker target=_blank rel="noopener noreffer">apache/rocketmq-docker</a> 这个 repo 下载到本地。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> rocketmq-docker
</span></span><span class=line><span class=cl>sh stage.sh 4.6.0
</span></span></code></pre></td></tr></table></div></div><p>执行该脚本后，会生成一个 <code>statge/4.6.0</code> 的目录，并在目录下会有不同类型部署方式相关的脚本和需要的配置文件，我们现在只关注 <code>docker-compose</code> 相关的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>~/workspace/rocketmq-docker/stages/4.6.0 on  master at 17:21:09 
</span></span><span class=line><span class=cl>➜ ls -al  
</span></span><span class=line><span class=cl>total <span class=m>56</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>13</span> shan.yu  staff   <span class=m>416</span> Mar <span class=m>14</span> 11:57 .
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>3</span> shan.yu  staff    <span class=m>96</span> Mar <span class=m>14</span> 10:24 ..
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>6</span> shan.yu  staff   <span class=m>192</span> Mar <span class=m>14</span> 10:24 data <span class=c1># 单节点部署方式需要的配置目录</span>
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>5</span> shan.yu  staff   <span class=m>160</span> Mar <span class=m>14</span> 12:04 docker-compose <span class=c1># docker-compose 部署方式需要的配置目录</span>
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>4</span> shan.yu  staff   <span class=m>128</span> Mar <span class=m>14</span> 10:24 kubernetes <span class=c1># k8s署方式需要的配置目录</span>
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff   <span class=m>902</span> Mar <span class=m>14</span> 10:24 play-consumer.sh
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff  <span class=m>1497</span> Mar <span class=m>14</span> 10:24 play-docker-compose.sh <span class=c1># docker-compose 部署脚本</span>
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff  <span class=m>3201</span> Mar <span class=m>14</span> 10:24 play-docker-dledger.sh
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff  <span class=m>2271</span> Mar <span class=m>14</span> 10:24 play-docker-tls.sh
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff  <span class=m>2354</span> Mar <span class=m>14</span> 10:24 play-docker.sh
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff   <span class=m>947</span> Mar <span class=m>14</span> 10:24 play-kubernetes.sh
</span></span><span class=line><span class=cl>-rwxr-xr-x   <span class=m>1</span> shan.yu  staff   <span class=m>901</span> Mar <span class=m>14</span> 10:24 play-producer.sh
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>17</span> shan.yu  staff   <span class=m>544</span> Mar <span class=m>14</span> 10:24 ssl
</span></span></code></pre></td></tr></table></div></div><p>从目录结构可以看到，我们只需要关注 <code>docker-compose</code> 目录和 <code>play_docker-compose.sh</code> 脚本即可。</p><p><code>docker-compose</code> 目录下有一个 <code>yaml</code> 文件，这个就是 docker-compose 的配置文件，我们来看一下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#Service for nameserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namesrv</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>apacherocketmq/rocketmq:4.6.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>rmqnamesrv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>9876</span><span class=p>:</span><span class=m>9876</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/namesrv/logs:/home/rocketmq/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>sh mqnamesrv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#Service for broker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>broker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>apacherocketmq/rocketmq:4.6.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>rmqbroker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>namesrv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>10909</span><span class=p>:</span><span class=m>10909</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>10911</span><span class=p>:</span><span class=m>10911</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>10912</span><span class=p>:</span><span class=m>10912</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NAMESRV_ADDR=rmqnamesrv:9876</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/broker/logs:/home/rocketmq/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/broker/store:/home/rocketmq/store</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/broker/conf/broker.conf:/opt/rocketmq-4.6.0/conf/broker.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>sh mqbroker -n rmqnamesrv:9876 -c /opt/rocketmq-4.6.0/conf/broker.conf</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>本来是启动的两个 <code>broker</code>, 我删掉一个，只保留一个 namesever 和一个 broker。 <code>./data/broker/conf/broker.conf</code> 为 broker 的配置文件路径，也是最开始执行的脚本生成的，我们可以看一下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>brokerClusterName = DefaultCluster
</span></span><span class=line><span class=cl>brokerName = broker-a
</span></span><span class=line><span class=cl>brokerId = 0
</span></span><span class=line><span class=cl>deleteWhen = 04
</span></span><span class=line><span class=cl>fileReservedTime = 48
</span></span><span class=line><span class=cl>brokerRole = ASYNC_MASTER
</span></span><span class=line><span class=cl>flushDiskType = ASYNC_FLUSH
</span></span><span class=line><span class=cl>## 注意！默认是不生成这一行的，但是你 docker 环境部署的话，broker 把自己注册到 nameserver 的时候用的是containerIP
</span></span><span class=line><span class=cl>## 类似 172.0.2.3 这种，这就导致你使用本地程序连 broker 会连接超时，我在这块卡了很久。
</span></span><span class=line><span class=cl>## 解决方案就是 将docker 宿主机执行 ifconfig 后，得到的本机 ip（不是 127.0.0.1）配到这里，从而解决这个问题。
</span></span><span class=line><span class=cl>brokerIP1=10.12.220.222
</span></span></code></pre></td></tr></table></div></div><p>需要主要上面的 <code>brokerIP1</code> 的配置，其他的都不用管。</p><p>此时直接执行 <code>./play-docker-compose.sh</code> 就可以了，等着镜像下完启动。启动完后，通过 <code>docker ps</code> 确认一下是否启动成功：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ docker ps             
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE                                      COMMAND                  CREATED       STATUS       PORTS                                                                      NAMES
</span></span><span class=line><span class=cl>9653b92c46b5   apacherocketmq/rocketmq:4.6.0              <span class=s2>&#34;sh mqbroker -n rmqn…&#34;</span>   <span class=m>4</span> hours ago   Up <span class=m>4</span> hours   0.0.0.0:10909-&gt;10909/tcp, 9876/tcp, 0.0.0.0:10911-10912-&gt;10911-10912/tcp   rmqbroker
</span></span><span class=line><span class=cl>e34ca8cbf7fa   apacherocketmq/rocketmq:4.6.0              <span class=s2>&#34;sh mqnamesrv&#34;</span>           <span class=m>4</span> hours ago   Up <span class=m>4</span> hours   10909/tcp, 0.0.0.0:9876-&gt;9876/tcp, 10911-10912/tcp                         rmqnamesrv
</span></span><span class=line><span class=cl>4957ecb3adc5   apacherocketmq/rocketmq-dashboard:latest   <span class=s2>&#34;sh -c &#39;java </span><span class=nv>$JAVA_O</span><span class=s2>…&#34;</span>   <span class=m>7</span> hours ago   Up <span class=m>7</span> hours   0.0.0.0:8080-&gt;8080/tcp                                                     rocketmq-dashboard
</span></span></code></pre></td></tr></table></div></div><p>上面发现多了一个 <code>rocketmq-dashboard</code>, 这是一个界面化管理的 UI 程序。因为自动生成的 docker-compose 的 yaml 文件里没有包含，我们可以自己单独运行或者补到 yaml 文件里，下面两种方式都提供。</p><p>直接 docker 运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ docker run -d --name rocketmq-dashboard --network docker-compose_default -e <span class=s2>&#34;JAVA_OPTS=-Drocketmq.namesrv.addr=rmqnamesrv:9876&#34;</span> -p 8080:8080 -t apacherocketmq/rocketmq-dashboard:latest
</span></span></code></pre></td></tr></table></div></div><p>添加到 docker compose yaml 中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rocketmq-dashboard</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>apacherocketmq/rocketmq-dashboard:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>rocketmq-dashboard</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>namesrv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>JAVA_OPTS=-Drocketmq.namesrv.addr=rmqnamesrv:9876</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这样你从本地 <code>8080</code> 端口就能看到 UI 页面：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./dashboard.png data-srcset="./dashboard.png, ./dashboard.png 1.5x, ./dashboard.png 2x" data-sizes=auto alt=./dashboard.png title=dashboard></p><h2 id=3-遇到的问题>3. 遇到的问题</h2><h3 id=31-没有最新的镜像>3.1. 没有最新的镜像</h3><p>通过 RocketMQ 发现目前最新版本以及到 <code>v4.9.3</code>， 而目前可用的镜像最新也是 <code>v4.6.0</code>，这个对于版本要求高的同学来说是一个麻烦的事儿，因为在本地直接执行最新代码需要以下环境：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Prerequisite
</span></span><span class=line><span class=cl>The following softwares are assumed installed:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>64bit OS, Linux/Unix/Mac is recommended;(Windows user see guide below)
</span></span><span class=line><span class=cl>64bit JDK 1.8+;
</span></span><span class=line><span class=cl>Maven 3.2.x;
</span></span><span class=line><span class=cl>Git;
</span></span><span class=line><span class=cl>4g+ free disk for Broker server
</span></span></code></pre></td></tr></table></div></div><p>我最后放弃使用最新版本了，也没有去研究 4.6.0 到 4.9.3 这个跨度有了什么比较大的更新，感兴趣的同学可以去<a href=https://rocketmq.apache.org/docs/quick-start/ target=_blank rel="noopener noreffer">官网</a>了解一下。</p><h3 id=32-docker-环境宿主机上程序无法正常连接>3.2. docker 环境宿主机上程序无法正常连接</h3><p>使用官方的 <code>rocketmq-docker</code> repo 生成了 docker-compose 文件后,直接执行发现本机程序连不上，报错信息大概如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ERRO[6243] get consumer list of group from broker error  broker=&#34;172.18.0.3:10911&#34; consumerGroup=push_msg underlayError=&#34;dial tcp 172.18.0.3:10911: i/o timeout&#34;
</span></span><span class=line><span class=cl>WARN[6243] do balance in group failed, get consumer id list failed  consumerGroup=push_msg topic=&#34;%RETRY%push_msg&#34;
</span></span><span class=line><span class=cl>ERRO[6246] get consumer list of group from broker error  broker=&#34;172.18.0.3:10911&#34; consumerGroup=push_msg underlayError=&#34;dial tcp 172.18.0.3:10911: i/o timeout&#34;
</span></span><span class=line><span class=cl>WARN[6246] do balance in group failed, get consumer id list failed  consumerGroup=push_msg topic=def_topic
</span></span><span class=line><span class=cl>WARN[6249] send heart beat to broker error               underlayError=&#34;dial tcp 172.18.0.3:10911: i/o timeout&#34;
</span></span></code></pre></td></tr></table></div></div><p>我一看这个 ip 就知道问题出在哪儿了，因为程序连接的是 nameserver 的端口，从 nameserver 服务拿到 broker 的 ip 端口再去连 broker，所以拿到了 broker 的 containerIP。</p><p>这个问题好在官方 repo 的 README 最后写了，需要配置宿主机的 ip，我配置完重新启动就 OK 了。</p><h2 id=4-总结>4. 总结</h2><p>本篇文件是讲述的内容重点如下：</p><ul><li>rocketmq docker 镜像现状</li><li>如何通过官方工具本地部署 rocketmq</li><li>部署和使用过程遇到的问题</li><li>如何部署最新rocketmq</li></ul><h2 id=5-链接>5. 链接🔗</h2><ul><li><a href=https://rocketmq.apache.org/ target=_blank rel="noopener noreffer">RocketMQ官方</a></li><li><a href=https://github.com/apache/rocketmq-docker target=_blank rel="noopener noreffer">RocketMQ-Docker</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-05-04</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/rocketmq-deploy/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ" data-hashtags=docker,rocketmq><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-hashtag=docker><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://yusank.github.io/posts/rocketmq-deploy/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Reddit" data-sharer=reddit data-url=https://yusank.github.io/posts/rocketmq-deploy/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ" data-ralateuid=yusann><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ" data-description><i class="fab fa-blogger fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/baidu.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://yusank.github.io/posts/rocketmq-deploy/ data-title="Docker 环境部署 RocketMQ"><i class="fab fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/docker/>docker</a>,&nbsp;<a href=/tags/rocketmq/>rocketmq</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/pdf-reader/ class=prev rel=prev title="Go 语言实现读取 pdf 文件内容"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Go 语言实现读取 pdf 文件内容</a>
<a href=/posts/macapp-by-go/ class=next rel=next title="Golang 开发 mac app">Golang 开发 mac app<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Keep learning and stay with lights.<br>❤ yusank<br></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2022</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by/4.0/deed.zh target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.5.4/dist/index.umd.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"Comment",lightTheme:"github-light",repo:"yusank/yusank.github.io"}},data:{"id-1":"usank`s Site","id-2":"usank`s Site"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:70}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-24P8ZSJHCQ',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-24P8ZSJHCQ" async></script></body></html>