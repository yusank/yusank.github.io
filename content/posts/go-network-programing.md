---
title: "网络编程"
date: 2021-12-16T10:00:00+08:00
lastmod: 2021-12-16T12:00:00+08:00
categories: ["网络编程"]
tags: ["go", "tcp", "网络"]
draft: true
---

> 本篇讲解网络编程中常见且重要的一些概念以及在 go 语言下的网络编程的关键点、需要注意事项和性能提升相关内容。

<!--more-->

## 概念

本小节把一些网络编程中常见的概念讲明白，看完后会对这些概念有清晰的了解。

在网络编程中大家应该对 `IO多路复用` 这个名字应该非常熟悉，那么什么是 `IO多路复用`？还有相关的其他概念吗？还有 `单路复用` 或者 `不复用`的场景吗？下面一个个解答这些问题？

### 什么是 IO 多路复用？

- IO 多路复用是一种同步IO模型，实现一个线程可以监视多个文件句柄；
- 一旦某个文件句柄就绪，就能够通知应用程序进行相应的读写操作；
- 没有文件句柄就绪就会阻塞应用程序，交出CPU。

> 多路是指网络连接，复用是指在同一个线程。

**同步与异步，阻塞和非阻塞？**

同步与异步区别在于内核是否会主动通知应用程序相应操作已完成
阻塞与非阻塞的区别在于应用程序发出请求后是否只等待内核该操作的响应而不去干别的事

> 注：如果是同步非阻塞I/O,应用程序虽不阻塞，但仍需要同过轮询的方式询问内核操作是否完成（对应I/O复用中的select和poll）

{{< admonition type=tip title="Linux 五大 IO 模型" open=true >}}
根据《UNIX网络编程》这本书讲述，5种IO模型分别是阻塞IO模型、非阻塞IO模型、IO复用模型、信号驱动的IO模型、异步IO模型；前4种为同步IO操作，只有异步IO模型是异步IO操作。
{{< /admonition >}}

**Q:如果不用复用会怎么？**

场景一：单线程程序：

当接受一个请求后，在处理一个 recv 或 send 前，这个链路是阻塞的，新的请求也不会被接受处理，相率极低。

```c
// 伪代码
while true {
    client_fd = accept()
    fds.append(client_fd)
    for fd in fds{
        if rec(fd) {
            // handle
            // 其他连接阻塞知道当前的处理完
        }
    }
}
```

### select

### poll

### epoll

### tcp

### udp

### http

## 实践

### tcp program

### udp program

## 优化

### gnet

### goroutine
